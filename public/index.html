<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Há»‡ thá»‘ng quáº£n lÃ½ tÃ i liá»‡u vÃ  bÃ i táº­p hiá»‡n Ä‘áº¡i">
    <meta name="theme-color" content="#667eea">
    <title>Quáº£n LÃ½ TÃ i Liá»‡u & BÃ i Táº­p</title>
    
    <!-- PWA -->
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icon-192.png">
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- Configuration -->
    <script src="config.js"></script>
    
    <!-- Register Service Worker -->
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/service-worker.js')
                .then(reg => console.log('Service Worker registered'))
                .catch(err => console.log('Service Worker registration failed'));
        }
    </script>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-top">
                <h1>ğŸ“š Quáº£n LÃ½ TÃ i Liá»‡u & BÃ i Táº­p</h1>
                <div class="header-actions">
                    <div id="points-display" onclick="showGamificationDashboard()" style="cursor: pointer;" title="Click Ä‘á»ƒ xem thÃ nh tÃ­ch">
                        Level 1 | 0 XP
                    </div>
                    <div class="user-info" id="user-info">
                        <span class="user-name" id="user-name">Loading...</span>
                        <div class="user-dropdown">
                            <button onclick="showProfile()">ğŸ‘¤ Há»“ sÆ¡</button>
                            <button onclick="showGamificationDashboard()">ğŸ® ThÃ nh TÃ­ch</button>
                            <button onclick="logout()">ğŸšª ÄÄƒng xuáº¥t</button>
                        </div>
                    </div>
                    <button class="header-btn" onclick="showPomodoroTimer()" title="Pomodoro Timer">ğŸ…</button>
                    <button class="header-btn" onclick="showMusicPlayer()" title="Nháº¡c há»c táº­p">ğŸµ</button>
                    <button class="header-btn" id="voice-btn" onclick="toggleVoiceCommand()" title="Äiá»u khiá»ƒn giá»ng nÃ³i">ğŸ¤</button>
                    <button class="header-btn" onclick="showAIChat()" title="AI Assistant">ğŸ¤–</button>
                    <button class="header-btn" onclick="showThemeSelector()" title="Äá»•i theme">ğŸ¨</button>
                    <button class="header-btn" onclick="toggleDarkMode()" title="Cháº¿ Ä‘á»™ tá»‘i">ğŸŒ™</button>
                    <button class="header-btn" onclick="showBackupModal()" title="Sao lÆ°u & KhÃ´i phá»¥c">ğŸ’¾</button>
                    <button class="header-btn" onclick="showSettingsModal()" title="CÃ i Ä‘áº·t">âš™ï¸</button>
                </div>
            </div>
            <div class="stats-bar" id="stats-bar"></div>
            <nav>
                <button class="tab-btn active" data-tab="documents">ğŸ“„ TÃ i Liá»‡u</button>
                <button class="tab-btn" data-tab="assignments">ğŸ“ BÃ i Táº­p</button>
                <button class="tab-btn" data-tab="media">ğŸ–¼ï¸ ThÆ° Viá»‡n</button>
                <button class="tab-btn" data-tab="notes">ğŸ“ Ghi ChÃº</button>
                <button class="tab-btn" data-tab="analytics">ğŸ“Š Thá»‘ng KÃª</button>
                <button class="tab-btn" data-tab="calendar">ğŸ“… Lá»‹ch Háº¹n</button>
            </nav>
        </header>

        <!-- Tab TÃ i Liá»‡u -->
        <div id="documents" class="tab-content active">
            <div class="upload-section">
                <div class="section-header">
                    <h2>ğŸ“¤ Táº£i LÃªn TÃ i Liá»‡u</h2>
                    <div class="upload-options">
                        <button type="button" class="option-btn" onclick="showTemplateSelector()" title="Sá»­ dá»¥ng máº«u">
                            ğŸ“„ Máº«u
                        </button>
                        <button type="button" class="option-btn" onclick="showBulkUpload()" title="Upload nhiá»u file">
                            ğŸ“ Bulk
                        </button>
                        <button type="button" class="option-btn" onclick="showURLUpload()" title="Upload tá»« URL">
                            ğŸ”— URL
                        </button>
                        <button type="button" class="option-btn" onclick="connectGoogleDrive()" title="Google Drive">
                            â˜ï¸ Drive
                        </button>
                    </div>
                </div>
                <form id="doc-form" class="upload-form">
                    <input type="text" id="doc-title" placeholder="TÃªn tÃ i liá»‡u *" required>
                    <select id="doc-category">
                        <option value="">Chá»n danh má»¥c</option>
                        <option value="lecture">ğŸ“– BÃ i giáº£ng</option>
                        <option value="exercise">âœï¸ BÃ i táº­p</option>
                        <option value="reference">ğŸ“š TÃ i liá»‡u tham kháº£o</option>
                        <option value="exam">ğŸ“ Äá» thi</option>
                        <option value="other">ğŸ“ KhÃ¡c</option>
                    </select>
                    <input type="file" id="doc-file" accept=".pdf,.doc,.docx,.txt,.ppt,.pptx,.xls,.xlsx" required>
                    <textarea id="doc-description" placeholder="MÃ´ táº£ tÃ i liá»‡u (tÃ¹y chá»n)"></textarea>
                    <div class="file-preview" id="doc-preview"></div>
                    <button type="submit">
                        <span class="btn-text">Táº£i LÃªn</span>
                        <span class="btn-loading" style="display:none;">â³ Äang táº£i...</span>
                    </button>
                </form>
            </div>

            <div class="list-section">
                <div class="section-header">
                    <h2>ğŸ“‹ Danh SÃ¡ch TÃ i Liá»‡u</h2>
                    <div class="view-controls">
                        <button class="view-btn active" data-view="grid" title="Xem dáº¡ng lÆ°á»›i">âŠ</button>
                        <button class="view-btn" data-view="list" title="Xem dáº¡ng danh sÃ¡ch">â˜°</button>
                    </div>
                </div>
                <div class="filter-section">
                    <input type="text" id="search-docs" placeholder="TÃ¬m kiáº¿m tÃ i liá»‡u...">
                    <select id="filter-doc-category">
                        <option value="all">Táº¥t cáº£ danh má»¥c</option>
                        <option value="lecture">BÃ i giáº£ng</option>
                        <option value="exercise">BÃ i táº­p</option>
                        <option value="reference">TÃ i liá»‡u tham kháº£o</option>
                        <option value="exam">Äá» thi</option>
                        <option value="other">KhÃ¡c</option>
                    </select>
                    <select id="sort-docs">
                        <option value="newest">Má»›i nháº¥t</option>
                        <option value="oldest">CÅ© nháº¥t</option>
                        <option value="name">TÃªn A-Z</option>
                    </select>
                </div>
                <div id="documents-list" class="items-list grid-view">
                    <div class="loading">Äang táº£i...</div>
                </div>
            </div>
        </div>

        <!-- Tab BÃ i Táº­p -->
        <div id="assignments" class="tab-content">
            <div class="upload-section">
                <h2>ğŸ“ Gá»­i BÃ i Táº­p</h2>
                <form id="assignment-form" class="upload-form">
                    <input type="text" id="assignment-title" placeholder="TÃªn bÃ i táº­p *" required>
                    <input type="text" id="assignment-student" placeholder="TÃªn há»c sinh *" required>
                    <input type="email" id="assignment-email" placeholder="Email há»c sinh (tÃ¹y chá»n)">
                    <input type="file" id="assignment-file" accept=".pdf,.doc,.docx,.txt,.zip,.rar" required multiple>
                    <textarea id="assignment-note" placeholder="Ghi chÃº (tÃ¹y chá»n)"></textarea>
                    <div class="file-preview" id="assignment-preview"></div>
                    <button type="submit">
                        <span class="btn-text">Gá»­i BÃ i Táº­p</span>
                        <span class="btn-loading" style="display:none;">â³ Äang gá»­i...</span>
                    </button>
                </form>
            </div>

            <div class="list-section">
                <h2>ğŸ“Š Danh SÃ¡ch BÃ i Táº­p ÄÃ£ Gá»­i</h2>
                <div class="filter-section">
                    <input type="text" id="search-student" placeholder="TÃ¬m theo tÃªn há»c sinh hoáº·c bÃ i táº­p...">
                    <select id="filter-status">
                        <option value="all">Táº¥t cáº£</option>
                        <option value="pending">Chá» cháº¥m</option>
                        <option value="graded">ÄÃ£ cháº¥m</option>
                    </select>
                    <select id="sort-assignments">
                        <option value="newest">Má»›i nháº¥t</option>
                        <option value="oldest">CÅ© nháº¥t</option>
                        <option value="grade-high">Äiá»ƒm cao nháº¥t</option>
                        <option value="grade-low">Äiá»ƒm tháº¥p nháº¥t</option>
                    </select>
                    <button class="btn-small" onclick="exportAssignments()">ğŸ“¥ Xuáº¥t Excel</button>
                </div>
                <div id="assignments-list" class="items-list">
                    <div class="loading">Äang táº£i...</div>
                </div>
            </div>
        </div>

        <!-- Tab ThÆ° Viá»‡n Media & Links -->
        <div id="media" class="tab-content">
            <div class="media-tabs">
                <button class="media-tab-btn active" data-media-tab="images">ğŸ–¼ï¸ HÃ¬nh áº¢nh</button>
                <button class="media-tab-btn" data-media-tab="links">ğŸ”— LiÃªn Káº¿t</button>
            </div>

            <!-- Sub-tab HÃ¬nh áº¢nh -->
            <div id="images" class="media-tab-content active">
                <div class="upload-section">
                    <h2>ğŸ“¤ Táº£i LÃªn HÃ¬nh áº¢nh</h2>
                    <form id="image-form" class="upload-form">
                        <input type="text" id="image-title" placeholder="TiÃªu Ä‘á» hÃ¬nh áº£nh *" required>
                        <select id="image-category">
                            <option value="">Chá»n danh má»¥c</option>
                            <option value="lecture">ğŸ“– BÃ i giáº£ng</option>
                            <option value="event">ğŸ‰ Sá»± kiá»‡n</option>
                            <option value="certificate">ğŸ† Chá»©ng chá»‰</option>
                            <option value="diagram">ğŸ“Š SÆ¡ Ä‘á»“</option>
                            <option value="other">ğŸ“ KhÃ¡c</option>
                        </select>
                        <input type="file" id="image-file" accept="image/*" multiple required>
                        <textarea id="image-description" placeholder="MÃ´ táº£ (tÃ¹y chá»n)"></textarea>
                        <div class="image-preview-grid" id="image-preview-grid"></div>
                        <button type="submit">
                            <span class="btn-text">Táº£i LÃªn</span>
                            <span class="btn-loading" style="display:none;">â³ Äang táº£i...</span>
                        </button>
                    </form>
                </div>

                <div class="list-section">
                    <div class="section-header">
                        <h2>ğŸ–¼ï¸ ThÆ° Viá»‡n HÃ¬nh áº¢nh</h2>
                        <div class="view-controls">
                            <button class="view-btn active" data-view="grid">âŠ</button>
                            <button class="view-btn" data-view="list">â˜°</button>
                        </div>
                    </div>
                    <div class="filter-section">
                        <input type="text" id="search-images" placeholder="TÃ¬m kiáº¿m hÃ¬nh áº£nh...">
                        <select id="filter-image-category">
                            <option value="all">Táº¥t cáº£ danh má»¥c</option>
                            <option value="lecture">BÃ i giáº£ng</option>
                            <option value="event">Sá»± kiá»‡n</option>
                            <option value="certificate">Chá»©ng chá»‰</option>
                            <option value="diagram">SÆ¡ Ä‘á»“</option>
                            <option value="other">KhÃ¡c</option>
                        </select>
                    </div>
                    <div id="images-list" class="items-list grid-view gallery-grid">
                        <div class="loading">Äang táº£i...</div>
                    </div>
                </div>
            </div>

            <!-- Sub-tab LiÃªn Káº¿t -->
            <div id="links" class="media-tab-content">
                <div class="upload-section">
                    <h2>ğŸ”— ThÃªm LiÃªn Káº¿t</h2>
                    <form id="link-form" class="upload-form">
                        <input type="text" id="link-title" placeholder="TiÃªu Ä‘á» liÃªn káº¿t *" required>
                        <input type="url" id="link-url" placeholder="https://example.com *" required>
                        <select id="link-category">
                            <option value="">Chá»n loáº¡i</option>
                            <option value="video">ğŸ¥ Video</option>
                            <option value="article">ğŸ“° BÃ i viáº¿t</option>
                            <option value="course">ğŸ“š KhÃ³a há»c</option>
                            <option value="tool">ğŸ› ï¸ CÃ´ng cá»¥</option>
                            <option value="reference">ğŸ“– TÃ i liá»‡u tham kháº£o</option>
                            <option value="other">ğŸ”— KhÃ¡c</option>
                        </select>
                        <textarea id="link-description" placeholder="MÃ´ táº£ (tÃ¹y chá»n)"></textarea>
                        <div class="link-preview" id="link-preview-box"></div>
                        <button type="submit">
                            <span class="btn-text">ThÃªm LiÃªn Káº¿t</span>
                        </button>
                    </form>
                </div>

                <div class="list-section">
                    <h2>ğŸ”— Danh SÃ¡ch LiÃªn Káº¿t</h2>
                    <div class="filter-section">
                        <input type="text" id="search-links" placeholder="TÃ¬m kiáº¿m liÃªn káº¿t...">
                        <select id="filter-link-category">
                            <option value="all">Táº¥t cáº£ loáº¡i</option>
                            <option value="video">Video</option>
                            <option value="article">BÃ i viáº¿t</option>
                            <option value="course">KhÃ³a há»c</option>
                            <option value="tool">CÃ´ng cá»¥</option>
                            <option value="reference">TÃ i liá»‡u tham kháº£o</option>
                            <option value="other">KhÃ¡c</option>
                        </select>
                    </div>
                    <div id="links-list" class="items-list">
                        <div class="loading">Äang táº£i...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Ghi ChÃº & To-Do -->
        <div id="notes" class="tab-content">
            <div class="notes-container">
                <!-- Quick Add -->
                <div class="quick-add-section">
                    <h2>âœï¸ Ghi ChÃº Nhanh</h2>
                    <div class="quick-add-form">
                        <input type="text" id="quick-note-title" placeholder="TiÃªu Ä‘á» ghi chÃº...">
                        <textarea id="quick-note-content" placeholder="Ná»™i dung ghi chÃº..." rows="3"></textarea>
                        <div class="quick-add-actions">
                            <select id="note-color">
                                <option value="yellow">ğŸŸ¨ VÃ ng</option>
                                <option value="blue">ğŸŸ¦ Xanh dÆ°Æ¡ng</option>
                                <option value="green">ğŸŸ© Xanh lÃ¡</option>
                                <option value="pink">ğŸŸª Há»“ng</option>
                                <option value="orange">ğŸŸ§ Cam</option>
                            </select>
                            <button onclick="addQuickNote()">â• ThÃªm Ghi ChÃº</button>
                        </div>
                    </div>
                </div>

                <!-- Notes Grid -->
                <div class="notes-grid-section">
                    <div class="section-header">
                        <h2>ğŸ“‹ Ghi ChÃº Cá»§a TÃ´i</h2>
                        <div class="notes-filter">
                            <button class="filter-btn active" data-filter="all">Táº¥t cáº£</button>
                            <button class="filter-btn" data-filter="pinned">ğŸ“Œ Ghim</button>
                            <button class="filter-btn" data-filter="archived">ğŸ“¦ LÆ°u trá»¯</button>
                        </div>
                    </div>
                    <div id="notes-grid" class="notes-grid">
                        <div class="loading">Äang táº£i...</div>
                    </div>
                </div>

                <!-- To-Do List -->
                <div class="todo-section">
                    <h2>âœ… Danh SÃ¡ch CÃ´ng Viá»‡c</h2>
                    <div class="todo-add">
                        <input type="text" id="todo-input" placeholder="ThÃªm cÃ´ng viá»‡c má»›i...">
                        <button onclick="addTodo()">â•</button>
                    </div>
                    <div id="todo-list" class="todo-list">
                        <div class="loading">Äang táº£i...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Thá»‘ng KÃª -->
        <div id="analytics" class="tab-content">
            <div class="analytics-grid">
                <div class="analytics-card">
                    <div class="card-icon">ğŸ“„</div>
                    <div class="card-content">
                        <h3>Tá»•ng TÃ i Liá»‡u</h3>
                        <div class="card-value" id="total-docs">0</div>
                    </div>
                </div>
                <div class="analytics-card">
                    <div class="card-icon">ğŸ“</div>
                    <div class="card-content">
                        <h3>Tá»•ng BÃ i Táº­p</h3>
                        <div class="card-value" id="total-assignments">0</div>
                    </div>
                </div>
                <div class="analytics-card">
                    <div class="card-icon">â³</div>
                    <div class="card-content">
                        <h3>Chá» Cháº¥m</h3>
                        <div class="card-value" id="pending-count">0</div>
                    </div>
                </div>
                <div class="analytics-card">
                    <div class="card-icon">â­</div>
                    <div class="card-content">
                        <h3>Äiá»ƒm Trung BÃ¬nh</h3>
                        <div class="card-value" id="avg-grade">0</div>
                    </div>
                </div>
            </div>

            <div class="charts-section">
                <div class="chart-card">
                    <h2>ğŸ“ˆ Báº£ng Xáº¿p Háº¡ng Há»c Sinh</h2>
                    <div id="leaderboard" class="leaderboard"></div>
                </div>
                <div class="chart-card">
                    <h2>ğŸ“Š PhÃ¢n Bá»‘ Äiá»ƒm</h2>
                    <div id="grade-distribution" class="grade-chart"></div>
                </div>
            </div>

            <div class="recent-activity">
                <h2>ğŸ• Hoáº¡t Äá»™ng Gáº§n ÄÃ¢y</h2>
                <div id="activity-log" class="activity-list"></div>
            </div>
        </div>

        <!-- Tab Lá»‹ch Háº¹n -->
        <div id="calendar" class="tab-content">
            <div class="calendar-section">
                <h2>ğŸ“… ThÃªm Lá»‹ch Háº¹n / Deadline</h2>
                <form id="deadline-form" class="upload-form">
                    <input type="text" id="deadline-title" placeholder="TiÃªu Ä‘á» *" required>
                    <input type="datetime-local" id="deadline-date" required>
                    <select id="deadline-type">
                        <option value="deadline">â° Deadline</option>
                        <option value="meeting">ğŸ‘¥ Há»p</option>
                        <option value="exam">ğŸ“ Kiá»ƒm tra</option>
                        <option value="event">ğŸ‰ Sá»± kiá»‡n</option>
                    </select>
                    <textarea id="deadline-description" placeholder="MÃ´ táº£ (tÃ¹y chá»n)"></textarea>
                    <button type="submit">
                        <span class="btn-text">ThÃªm Lá»‹ch</span>
                    </button>
                </form>
            </div>

            <div class="list-section">
                <h2>ğŸ“‹ Danh SÃ¡ch Lá»‹ch Háº¹n</h2>
                <div class="filter-section">
                    <select id="filter-deadline-type">
                        <option value="all">Táº¥t cáº£</option>
                        <option value="deadline">Deadline</option>
                        <option value="meeting">Há»p</option>
                        <option value="exam">Kiá»ƒm tra</option>
                        <option value="event">Sá»± kiá»‡n</option>
                    </select>
                    <select id="filter-deadline-status">
                        <option value="all">Táº¥t cáº£</option>
                        <option value="upcoming">Sáº¯p tá»›i</option>
                        <option value="overdue">QuÃ¡ háº¡n</option>
                        <option value="completed">HoÃ n thÃ nh</option>
                    </select>
                </div>
                <div id="deadlines-list" class="items-list">
                    <div class="loading">Äang táº£i...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <!-- Backup Modal -->
    <div id="backup-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ’¾ Sao LÆ°u & KhÃ´i Phá»¥c</h2>
                <button class="modal-close" onclick="closeBackupModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="backup-section">
                    <h3>ğŸ“¤ Xuáº¥t Dá»¯ Liá»‡u</h3>
                    <p>Táº£i xuá»‘ng toÃ n bá»™ dá»¯ liá»‡u cá»§a báº¡n</p>
                    <button class="btn-primary" onclick="exportAllData()">ğŸ“¥ Xuáº¥t Táº¥t Cáº£ Dá»¯ Liá»‡u (JSON)</button>
                    <button class="btn-primary" onclick="exportDatabase()">ğŸ’¾ Táº£i Database (SQLite)</button>
                </div>
                <div class="backup-section">
                    <h3>ğŸ“¥ Nháº­p Dá»¯ Liá»‡u</h3>
                    <p>KhÃ´i phá»¥c dá»¯ liá»‡u tá»« file backup</p>
                    <input type="file" id="import-file" accept=".json" style="display:none">
                    <button class="btn-primary" onclick="document.getElementById('import-file').click()">ğŸ“¤ Nháº­p Dá»¯ Liá»‡u</button>
                </div>
                <div class="backup-section">
                    <h3>ğŸ—‘ï¸ XÃ³a Dá»¯ Liá»‡u</h3>
                    <p class="warning-text">âš ï¸ Cáº£nh bÃ¡o: HÃ nh Ä‘á»™ng nÃ y khÃ´ng thá»ƒ hoÃ n tÃ¡c!</p>
                    <button class="btn-danger" onclick="clearAllData()">ğŸ—‘ï¸ XÃ³a ToÃ n Bá»™ Dá»¯ Liá»‡u</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>âš™ï¸ CÃ i Äáº·t</h2>
                <button class="modal-close" onclick="closeSettingsModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="settings-group">
                    <h3>ğŸ¨ Giao Diá»‡n</h3>
                    <label class="setting-item">
                        <input type="checkbox" id="setting-dark-mode">
                        <span>Cháº¿ Ä‘á»™ tá»‘i</span>
                    </label>
                    <label class="setting-item">
                        <input type="checkbox" id="setting-animations" checked>
                        <span>Hiá»‡u á»©ng chuyá»ƒn Ä‘á»™ng</span>
                    </label>
                </div>
                <div class="settings-group">
                    <h3>ğŸ”” ThÃ´ng BÃ¡o</h3>
                    <label class="setting-item">
                        <input type="checkbox" id="setting-notifications" checked>
                        <span>Báº­t thÃ´ng bÃ¡o</span>
                    </label>
                    <label class="setting-item">
                        <input type="checkbox" id="setting-deadline-alerts" checked>
                        <span>Cáº£nh bÃ¡o deadline</span>
                    </label>
                </div>
                <div class="settings-group">
                    <h3>ğŸ“Š Hiá»ƒn Thá»‹</h3>
                    <label class="setting-item">
                        <span>Sá»‘ items má»—i trang:</span>
                        <select id="setting-items-per-page">
                            <option value="10">10</option>
                            <option value="20" selected>20</option>
                            <option value="50">50</option>
                            <option value="100">100</option>
                        </select>
                    </label>
                </div>
                <button class="btn-primary" onclick="saveSettings()">ğŸ’¾ LÆ°u CÃ i Äáº·t</button>
            </div>
        </div>
    </div>

    <!-- Image Modal (will be created dynamically) -->

    <!-- Floating Action Button -->
    <div class="fab-container">
        <button class="fab">â•</button>
        <div class="fab-menu">
            <div class="fab-menu-item" onclick="document.getElementById('doc-file').click()">
                ğŸ“„ Upload TÃ i Liá»‡u
            </div>
            <div class="fab-menu-item" onclick="document.getElementById('assignment-file').click()">
                ğŸ“ Ná»™p BÃ i Táº­p
            </div>
            <div class="fab-menu-item" onclick="addQuickNote()">
                âœï¸ Ghi ChÃº Nhanh
            </div>
            <div class="fab-menu-item" onclick="showPomodoroTimer()">
                ğŸ… Pomodoro Timer
            </div>
            <div class="fab-menu-item" onclick="showMusicPlayer()">
                ğŸµ Nháº¡c Há»c Táº­p
            </div>
            <div class="fab-menu-item" onclick="showAIChat()">
                ğŸ¤– AI Assistant
            </div>
            <div class="fab-menu-item" onclick="showGamificationDashboard()">
                ğŸ® ThÃ nh TÃ­ch
            </div>
            <div class="fab-menu-item" onclick="showActiveUsers()">
                ğŸ‘¥ Users Online
            </div>
        </div>
    </div>

    <!-- Keyboard Shortcuts Help -->
    <div id="shortcuts-help" class="shortcuts-help">
        <h3 style="margin-bottom: 15px;">âŒ¨ï¸ PhÃ­m Táº¯t</h3>
        <div class="shortcut-item">
            <span>Upload file</span>
            <span class="shortcut-key">Ctrl + U</span>
        </div>
        <div class="shortcut-item">
            <span>TÃ¬m kiáº¿m</span>
            <span class="shortcut-key">Ctrl + F</span>
        </div>
        <div class="shortcut-item">
            <span>ÄÃ³ng modal</span>
            <span class="shortcut-key">ESC</span>
        </div>
        <button onclick="document.getElementById('shortcuts-help').classList.remove('show')" 
                style="margin-top: 10px; width: 100%;">ÄÃ³ng</button>
    </div>

    <script>
        // Check authentication before loading app
        const token = localStorage.getItem('auth_token');
        if (!token) {
            window.location.href = '/login.html';
        }
        
        // Verify token
        fetch('http://localhost:3000/api/auth/verify', {
            headers: { 'Authorization': `Bearer ${token}` }
        })
        .then(res => res.json())
        .then(result => {
            if (!result.valid) {
                localStorage.removeItem('auth_token');
                localStorage.removeItem('user_info');
                window.location.href = '/login.html';
            } else {
                // Update user info
                localStorage.setItem('user_info', JSON.stringify(result.user));
                document.getElementById('user-name').textContent = result.user.fullName || result.user.username;
            }
        })
        .catch(() => {
            window.location.href = '/login.html';
        });
        
        // Add token to all API requests
        const originalFetch = window.fetch;
        window.fetch = function(url, options = {}) {
            if (url.includes('/api/') && !url.includes('/auth/')) {
                options.headers = options.headers || {};
                options.headers['Authorization'] = `Bearer ${token}`;
            }
            return originalFetch(url, options);
        };
        
        function logout() {
            if (!confirm('Báº¡n cÃ³ cháº¯c muá»‘n Ä‘Äƒng xuáº¥t?')) return;
            
            fetch('http://localhost:3000/api/auth/logout', {
                method: 'POST',
                headers: { 'Authorization': `Bearer ${token}` }
            })
            .then(() => {
                localStorage.removeItem('auth_token');
                localStorage.removeItem('user_info');
                localStorage.removeItem('remember_me');
                window.location.href = '/login.html';
            });
        }
        
        function showProfile() {
            const user = JSON.parse(localStorage.getItem('user_info'));
            const modal = document.createElement('div');
            modal.className = 'modal show';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>ğŸ‘¤ Há»“ SÆ¡ NgÆ°á»i DÃ¹ng</h2>
                        <button class="modal-close" onclick="this.closest('.modal').remove()">Ã—</button>
                    </div>
                    <div class="modal-body">
                        <div class="profile-info">
                            <div class="profile-avatar">
                                ${user.avatar ? `<img src="${user.avatar}" alt="Avatar">` : 'ğŸ‘¤'}
                            </div>
                            <div class="profile-details">
                                <p><strong>Há» tÃªn:</strong> ${user.fullName}</p>
                                <p><strong>TÃªn Ä‘Äƒng nháº­p:</strong> ${user.username}</p>
                                <p><strong>Email:</strong> ${user.email}</p>
                                <p><strong>Vai trÃ²:</strong> ${getRoleName(user.role)}</p>
                            </div>
                        </div>
                        <button class="btn-primary" onclick="changePassword()">ğŸ”’ Äá»•i Máº­t Kháº©u</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function getRoleName(role) {
            const roles = {
                student: 'ğŸ‘¨â€ğŸ“ Há»c sinh',
                teacher: 'ğŸ‘¨â€ğŸ« GiÃ¡o viÃªn',
                admin: 'ğŸ‘‘ Quáº£n trá»‹ viÃªn'
            };
            return roles[role] || role;
        }
        
        function changePassword() {
            const oldPassword = prompt('Nháº­p máº­t kháº©u cÅ©:');
            if (!oldPassword) return;
            
            const newPassword = prompt('Nháº­p máº­t kháº©u má»›i (tá»‘i thiá»ƒu 6 kÃ½ tá»±):');
            if (!newPassword || newPassword.length < 6) {
                alert('Máº­t kháº©u má»›i pháº£i cÃ³ Ã­t nháº¥t 6 kÃ½ tá»±!');
                return;
            }
            
            fetch('http://localhost:3000/api/auth/change-password', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({ oldPassword, newPassword })
            })
            .then(res => res.json())
            .then(result => {
                if (result.message) {
                    alert('âœ… ' + result.message);
                } else {
                    alert('âŒ ' + result.error);
                }
            });
        }
    </script>
    <script src="app.js"></script>
    <script src="features.js"></script>
    <script src="media.js"></script>
    <script src="advanced.js"></script>
    <script src="notes.js"></script>
    <script src="modern-features.js"></script>
    <script src="fun-features.js"></script>
    
    <script>
        // Hook gamification into existing functions after all scripts loaded
        window.addEventListener('load', function() {
            // Wrap upload document
            const originalUploadDocument = window.uploadDocument;
            if (originalUploadDocument) {
                window.uploadDocument = async function() {
                    const result = await originalUploadDocument.apply(this, arguments);
                    if (window.addPoints) {
                        window.addPoints(10, 'Upload tÃ i liá»‡u');
                        window.unlockAchievement('first_upload');
                    }
                    return result;
                };
            }
            
            // Wrap submit assignment
            const originalSubmitAssignment = window.submitAssignment;
            if (originalSubmitAssignment) {
                window.submitAssignment = async function() {
                    const result = await originalSubmitAssignment.apply(this, arguments);
                    if (window.addPoints) {
                        window.addPoints(15, 'Ná»™p bÃ i táº­p');
                        window.unlockAchievement('first_assignment');
                    }
                    return result;
                };
            }
            
            // Wrap add quick note
            const originalAddQuickNote = window.addQuickNote;
            if (originalAddQuickNote) {
                window.addQuickNote = async function() {
                    const result = await originalAddQuickNote.apply(this, arguments);
                    if (window.addPoints) {
                        window.addPoints(5, 'Táº¡o ghi chÃº');
                    }
                    return result;
                };
            }
        });
    </script>
</body>
</html>
